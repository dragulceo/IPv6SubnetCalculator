"use strict";angular.module("ipv6App",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/ip/:ipv6/:mask1/:mask2/index/:index",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/ip/:ipv6/:mask1/:mask2/page/:page",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/ip/:ipv6/:mask1/:mask2",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("ipv6App").controller("MainCtrl",["$scope","$routeParams","$location","$timeout","History","SharedRecord",function(a,b,c,d,e,f){a.record=f,a.$watch(function(){return a.record.getOneLine()},function(){a.oneLine=a.record.getOneLine()}),a.$watch(function(){return a.record.getUrl()},function(){if(a.record.ipv6){var b=a.record.getUrl(!0);c.path(b)}}),a.onOneLineChange=function(){a.record.fromOneLine(a.oneLine)},a.saveToHistory=function(){a.saveError=!e.addRecord(a.record.exportObject()),a.saveOk=!a.saveError},b.ipv6&&a.record.initFromObject(b)}]),angular.module("ipv6App").controller("HistoryCtrl",["$scope","$location","History","record",function(a,b,c,d){a.deleteFromHistory=function(a){confirm("Are you sure you want to delete the record?")&&c.removeRecord(a)},a.loadFromHistory=function(a){b.path(new d(a).getUrl())},a.history=c.getRecords()}]),angular.module("ipv6App").controller("Ipv6subnetCtrl",["$scope","$routeParams","$location","Ipv6util","Errors","SharedRecord",function(a,b,c,d,e,f){function g(){return!!a.record&&a.record.ipv6}function h(){if(g()){var b,c,d=0,e=[],f=a.record,h=f.getPrefixes();if(a.subnets=h.subnets,h.pages=parseInt(h.pages,10),a.record.page||(a.record.page=0),b=parseInt(f.page,10)||1,c=h.pages+1,c>5)b>1&&e.splice(0,0,"Prev"),e.splice(1,0,1,2),1===b?e.splice(e.length,0,"..."):2===b?e.splice(e.length,0,b+1,"..."):3===b?e.splice(e.length,0,b,b+1,"..."):b>2&&c-3>b?e.splice(e.length,0,"...",b-1,b,b+1,"..."):b===c-3?e.splice(e.length,0,"...",b-1,b):b===c-2?e.splice(e.length,0,"...",b-1):b===c-1&&e.splice(e.length,0,"..."),e.splice(e.length,0,c-2,c-1),c-1>b&&e.splice(e.length,0,"Next");else if(c>1)for(;c--;)e.push(d++);a.pages=e}}a.record=f,a.$watch(function(){return a.record.getOneLine()},function(){a.shouldShowSubnets()&&h()}),a.ipAddress=function(){return e.resetErrors(),g()?a.record.getIPv6():"---"},a.shouldShowIpAddress=function(){return a.record&&a.record.ipv6&&a.record.isTypeIndex()},a.setPage=function(b){if("Next"===b)b=a.record.page+1;else if("Prev"===b)b=Math.max(a.record.page-1,1);else if(b&&!angular.isNumber(b))return;a.record.page=b},a.shouldShowSubnets=function(){return a.record&&a.record.ipv6&&a.record.isTypeList()}}]),angular.module("ipv6App").service("History",["$cookieStore",function(a){var b,c,d=a.get("history")||[];return angular.isArray(d)||(d=[]),b=function(){a.put("history",d)},c=function(a){for(var b,c=d.length;c--;)if(b=d[c],b.ipv6===a.ipv6&&b.mask1===a.mask1&&b.mask2===a.mask2&&b.index===a.index&&b.page===a.page&&b.type===a.type)return c;return-1},{getRecords:function(){return d},addRecord:function(a){return-1===c(a)?(d.push(a),b(),!0):!1},removeRecord:function(a){var e=c(a);-1!=e&&(d.splice(e,1),b())}}}]),angular.module("ipv6App").service("Ipv6util",function(){var a,b,c,d,e;return a=function(a){return a.replace(/(:0(:(0))+(:|$))/,"::")},b=function(a){var b,c,d,e=a.match(/::/),f=[],g=[];if(e){for(a=a.replace(/::/,":_:"),a=a.replace(/:$/,":0"),c=9-a.split(":").length,d=[];c--;)d.push("0");a=a.replace("_",d.join(":"))}for(g=a.split(":"),b=0,c=g.length;c>b;b++)g[b]=parseInt(g[b],16),f[2*b+1]=255&g[b],f[2*b]=g[b]>>8;return f},c=function(b,c){var d,e,f,g=[];for(b=b.splice(-16);b.length<16;)b.push(0);for(f=b.length,e=0;f>e;e++)b[e]<0&&(b[e]+=256);for(e=0;f/2>e;e++)g.push(((b[2*e]<<8)+b[2*e+1]).toString(16));return d=g.join(":"),c?a(d):d},d=function(a,d,e,f){var g,h,i;return g=new BigInteger(b(a)),i=new BigInteger("ffffffffffffffff",16).shiftLeft(128-d),h=g.and(i),f=new BigInteger(""+f,10),f=f.multiply(new BigInteger("1").shiftLeft(128-e)),h=h.add(f),c(h.toByteArray(),!0)},e=function(a,d,e,f){var g,h,i,j,k,l,m=[],n=32,o=new BigInteger(b(a));if(d=parseInt(d,10),e=parseInt(e,10),!d||isNaN(d)||!e||isNaN(e))return!1;if(d>e||e>64)return!1;for(g=new BigInteger("ffffffffffffffff",16).shiftLeft(128-d),h=o.and(g),l=new BigInteger("1").shiftLeft(e-d).intValue(),j=new BigInteger("1").shiftLeft(128-e),f=parseInt(f,10),f>0&&(f-=1),i=Math.min((f+1)*n,l),h=h.add(j.multiply(new BigInteger((f*n).toString()))),k=f*n;i>k;k++)m.push(c(h.toByteArray(),!0)),h=h.add(j);return{subnets:m,pages:l/n}},{getSubnet:d,getListOfPrefixes:e}}),angular.module("ipv6App").service("Errors",function(){function a(a){c.push(a)}function b(){c=[]}var c=[];return{getErrors:function(){return c},addError:a,resetErrors:b}}),angular.module("ipv6App").service("Utils",function(){return{}}),angular.module("ipv6App").factory("record",["Ipv6util",function(a){var b,c=/[a-f0-9:]+\/[0-9]+ [0-9]+( ([0-9]+|p[0-9]+)){1}/i,d=/ p[0-9]+\s*$/i,e=1,f=2;return b=function(a){this.initFromObject(a||{})},b.prototype.initFromObject=function(a){for(var b,c,d=["ipv6","mask1","mask2","page","index","result","type"],g={page:!0,index:!0,type:!0},h=d.length;h--;)b=d[h],c=b in a?a[b]:0,this[b]=b in g?parseInt(c,10):c||"";0===this.type&&("page"in a?(this.type=e,0===this.page&&(this.page=1)):this.type=f)},b.prototype.exportObject=function(){return{ipv6:this.ipv6,mask1:this.mask1,mask2:this.mask2,index:this.index,page:this.page,type:this.type,result:this.index?this.getIPv6():0}},b.prototype.getIPv6=function(){return a.getSubnet(this.ipv6||"",this.mask1,this.mask2,this.index)},b.prototype.getUrl=function(a){var b;return b="ip/"+this.ipv6+"/"+this.mask1+"/"+this.mask2,b=this.type===e?b+"/page/"+this.page:b+"/index/"+this.index,a&&(b="/"+b),b},b.prototype.getOneLine=function(){var a="";return this.ipv6&&(a=this.ipv6+"/"+this.mask1+" "+this.mask2,a+=this.type===e?" p"+this.page:" "+this.index),a},b.prototype.isTypeList=function(){return this.type===e},b.prototype.isTypeIndex=function(){return this.type===f},b.prototype.fromOneLine=function(a){var b,g,h=a.split(" "),i=h.length,j=0,k=0,l=i-1;a.match(c)&&(b=(h[0]||"").split("/"),a.match(d)?(h[l]=h[l].replace(/^p/,""),j=parseInt(h[l],10),g=e):(k=parseInt(h[2],10)||0,g=f),this.initFromObject({ipv6:b[0]||"0::0",mask1:parseInt(b[1],10)||1,mask2:parseInt(h[1],10)||1,page:j,index:k,type:g}))},b.prototype.getPrefixes=function(){return a.getListOfPrefixes(this.ipv6,this.mask1,this.mask2,this.page)},b}]),angular.module("ipv6App").directive("ipv6onblur",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.ipv6onblur);c.bind("blur",function(a){b.$apply(function(){e(b,{$event:a})})})}}}]),angular.module("ipv6App").service("SharedRecord",["record",function(a){return new a}]);